<!DOCTYPE html>

<head>
  <base href="/constellation-app.github.io/help/constellation/">

  <!-- Stylesheets -->
  <link rel="stylesheet" href="../../../assets/css/app.css" />
  <link rel="stylesheet" href="../../../assets/bootstrap/css/bootstrap.css" />
  <link rel="stylesheet" href="../../../assets/bootstrap/css/search.css" />
  <noscript>
    <link rel="stylesheet" href="../../../assets/css/noscript.css" />
  </noscript>

  <!-- Scripts -->
  <script src="../../../assets/js/jquery.min.js"></script>
  <script src="../../../assets/js/js.cookie.min.js"></script>
  <script src="../../../assets/js/jquery.dropotron.min.js"></script>
  <script src="../../../assets/js/jquery.scrolly.min.js"></script>
  <script src="../../../assets/js/jquery.scrollex.min.js"></script>
  <script src="../../../assets/js/browser.min.js"></script>
  <script src="../../../assets/js/breakpoints.min.js"></script>
  <script src="../../../assets/js/app.js"></script>
  <script src="../../../assets/bootstrap/js/bootstrap.js"></script>
  <script src="../../../assets/bootstrap/js/index.min.js"></script>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-139401597-2"></script>

  <script>
    $(function() {
      $("#includedContent").load("../toc.html");
    });
  </script>

  <!-- Nav -->
  <nav id="nav">
    <ul>
      <li><a href="../../../index.html">Home</a></li>
      <li><a href="../../../index.html#banner" class="scrolly">About</a></li>
      <li><a href="../../../index.html#features" class="scrolly">Features</a></li>
      <li><a href="../../../download.html" class="scrolly">Download</a></li>
      <li><a href="../../../blog.html" class="scrolly">Blog</a></li>
      <li><a href="../ext/docs/CoreFunctionality/src/au/gov/asd/tac/constellation/functionality/about-constellation.html" class="scrolly">Documentation</a></li>
      <li><a href="../../../index.html#contact" class="scrolly">Contact</a></li>
    </ul>
  </nav>

</head>

<body style="padding-top: 100px;">

  <div class="row">
    <div class="col-4 col-sm-3">
      <div id="includedContent"></div>
    </div>
    <div class="col-8 col-sm-9">
        <!-- Create the searchbar -->
        <div class="App">
            <!-- Search bar -->
            <div class="SearchBox">
                <div class="Search">
                    <button class="icon">&#x1F50D</button>
                    <input type="text" placeholder="Search help documentation" />
                    <button class="clear">&times;</button>
                </div>
                <ul class="SuggestionList"></ul>
            </div>
            <ul class="ResultsList"></ul>
        </div>

      <h1>Expressions Framework</h1>
      <p>The expressions framework is a structure which can be used to query or assign the Vertex and Transaction attributes within a graph. The framework will work on all attributes which do not include a restricted character within its "AttributeName". An expression can return zero or more matches.</p>
      <h2>Query Language</h2>
      <p>The query language is designed to be robust with respect to features such as nesting and type casting. To allow this, plain text is used to gain the flexibility necessary. Users will be responsible for forming queries which adhere to the below rules.</p>
      <h2>Forming a Query Expression</h2>
      <p>A valid query for a vertex or transaction takes the form of [AttributeName] [Operator] [value].</p>
      <ul>
      <li>The "AttributeName" used will not include any restricted characters, and will be case sensitive.</li>
      <li>The "AttributeName" will be represented as plain, unquoted text.</li>
      <li>The "Operator" must be separated by atleast one whitespace character.</li>
      <li>The "Operator" must be valid and from the list specified below.</li>
      <li>The "Value" must be quoted using single('value') or double quotes("value").</li>
      </ul>
      <p>How to form an expression to find a vertex with the "Label" attribute matching "Vertex #1&lt;Unknown&gt;".</p>
      <ul>
      <li>"AttributeName" is Label</li>
      <li>"Operator" is == or equals</li>
      <li>"Value" is "Vertex #1&lt;Unknown&gt;" or 'Vertex #1&lt;Unknown&gt;'</li>
      </ul>
      <p>Combining these into the pattern [AttributeName] [Operator] [Value] yields the following suitable query strings.</p>
      <ul>
      <li>Label == "Vertex #1&lt;Unknown&gt;"</li>
      <li>Label == 'Vertex #1&lt;Unknown&gt;'</li>
      <li>Label equals "Vertex #1&lt;Unknown&gt;"</li>
      <li>Label equals 'Vertex #1&lt;Unknown&gt;'</li>
      </ul>
      <h2>Operators</h2>
      <p>Operators can be used to query, edit, assign and compare values. Below is the current list of supported operators.</p>
      <table class="table table-striped">
      <thead>
      <tr class="header">
      <th><strong>Operator</strong></th>
      <th><strong>Query Representation</strong></th>
      <th><strong>Word Operator</strong></th>
      <th><strong>Precedence</strong></th>
      </tr>
      </thead>
      <tbody>
      <tr class="odd">
      <td>Not</td>
      <td>!</td>
      <td>not</td>
      <td>2</td>
      </tr>
      <tr class="even">
      <td>Multiply</td>
      <td>*</td>
      <td>multiply</td>
      <td>3</td>
      </tr>
      <tr class="odd">
      <td>Divide</td>
      <td>/</td>
      <td>divide</td>
      <td>3</td>
      </tr>
      <tr class="even">
      <td>Modulo</td>
      <td>%</td>
      <td>mod</td>
      <td>3</td>
      </tr>
      <tr class="odd">
      <td>Add</td>
      <td>+</td>
      <td>add</td>
      <td>4</td>
      </tr>
      <tr class="even">
      <td>Subtract</td>
      <td>-</td>
      <td>subtract</td>
      <td>4</td>
      </tr>
      <tr class="odd">
      <td>Contains</td>
      <td>N/A</td>
      <td>contains</td>
      <td>4</td>
      </tr>
      <tr class="even">
      <td>Starts With</td>
      <td>N/A</td>
      <td>startswith</td>
      <td>4</td>
      </tr>
      <tr class="odd">
      <td>Ends With</td>
      <td>N/A</td>
      <td>endswith</td>
      <td>4</td>
      </tr>
      <tr class="even">
      <td>Greater Than</td>
      <td>&gt;</td>
      <td>gt</td>
      <td>6</td>
      </tr>
      <tr class="odd">
      <td>Less Than</td>
      <td>&lt;</td>
      <td>lt</td>
      <td>6</td>
      </tr>
      <tr class="even">
      <td>Greater Than Or Equals</td>
      <td>&gt;=</td>
      <td>gteq</td>
      <td>6</td>
      </tr>
      <tr class="odd">
      <td>Less Than Or Equals</td>
      <td>&lt;=</td>
      <td>lteq</td>
      <td>6</td>
      </tr>
      <tr class="even">
      <td>Equals</td>
      <td>==</td>
      <td>equals</td>
      <td>7</td>
      </tr>
      <tr class="odd">
      <td>Not Equals</td>
      <td>!=</td>
      <td>notequals</td>
      <td>7</td>
      </tr>
      <tr class="even">
      <td>Bitwise And</td>
      <td>&amp;</td>
      <td>N/A</td>
      <td>8</td>
      </tr>
      <tr class="odd">
      <td>Exclusive Or</td>
      <td>^</td>
      <td>xor</td>
      <td>9</td>
      </tr>
      <tr class="even">
      <td>Bitwise Or</td>
      <td>|</td>
      <td>N/A</td>
      <td>10</td>
      </tr>
      <tr class="odd">
      <td>And</td>
      <td>&amp;&amp;</td>
      <td>and</td>
      <td>11</td>
      </tr>
      <tr class="even">
      <td>Or</td>
      <td>||</td>
      <td>or</td>
      <td>12</td>
      </tr>
      <tr class="odd">
      <td>Assign</td>
      <td>=</td>
      <td>assign</td>
      <td>14</td>
      </tr>
      </tbody>
      </table>

      <h2>Nested Queries</h2>
      <p>The expression framework allows for nested queries. This makes querying complex conditions possible. Nested queries are created by surrounding internal queries with parenthesis (inner query).<br />
      See below for an example.</p>
      <p>(Label == 'Vertex #0&lt;Unknown&gt;' || Label == 'Vertex #1&lt;Unknown&gt;' ) &amp;&amp; Type == 'Machine Identifier'</p>
      <p>Will show a Vertex which is either Vertex #0&lt;Unknown&gt; or Vertex #1&lt;Unknown&gt; and has a "Type" of 'Machine Identifier'.</p>
      <h2>Restricted Characters</h2>
      <p>Restricted characters are characters written into the query string which will not be parsed correctly due to the constraints of the query language.</p>
      <ul>
      <li>Single Quote - '''</li>
      <li>Double Quote - '"'</li>
      <li>Parenthesis - '(' and ')' (<em>when not used as a nesting delimiter</em>)</li>
      </ul>
      <h2>Advanced Usage</h2>
      <h3>Precalculation Tools</h3>
      <p>The framework allows complex actions such as arithmetic operation on both sides of the Operator. The framework will attempt to correctly calculate any well parsed expression.<br />
      Care must be taken for things like lexicographic ordering with different variable types.<br />
      Addition as shown below works similar to appending for String types.</p>
      <p>(Label + 'extratext') == 'Vertex #1&lt;Unknown&gt;extratext'</p>
    </div>
  </div>

  <!-- Footer -->
  <div id="footer">
    <div class="container">
      <div class="row">
        <div class="col-12">

          <!-- Contact Us -->
          <section id="contact" class="contact">
            <header>
              <h3>Contact Us</h3>
            </header>
            <p>Feel free to ask a question on Gitter or file an issue on our GitHub Issues board.</p>
            <p>
              <a href="https://gitter.im/constellation-app/community" class="button">Contact Us</a>
              <span>&nbsp;&nbsp;&nbsp;</span>
              <a href="https://github.com/constellation-app/constellation/blob/master/CONTRIBUTING.md#reporting-bugs" class="button">Report Issue</a>
            </p>
          </section>

          <!-- Copyright -->
          <div class="copyright">
            <ul class="menu">
              <li>&copy; 2025 | Website developed by the <a href="https://github.com/constellation-app">Constellation community</a>. All rights reserved.</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    $(document).ready(function() {
      var allCookies = Cookies.get();
      for (var cookie in allCookies) {
        if (cookie != null) {
          $("#" + cookie).removeClass('show');
          var cookieValue = Cookies.get(cookie);
          if (cookieValue == ("true")) {
            $("#" + cookie).collapse('show');
          } else {
            $("#" + cookie).collapse('hide');
            $("#" + cookie + " .collapse").removeClass('show');
          }
        }
      }
    });

    $(".collapse").on('shown.bs.collapse', function(e) {
      console.log('shown');
      e.stopPropagation();
      var active = $(this).attr('id');
      Cookies.set(active, "true");
      $("#" + active).addClass('show');
    });
    $(".collapse").on('hidden.bs.collapse', function(e) {
      console.log('collapsed');
      e.stopPropagation();
      var active = $(this).attr('id');
      Cookies.set(active, "false");
      $("#" + active).removeClass('show');
      $("#" + active).collapse('hide');
    });

    window.dataLayer = window.dataLayer || [];

    function gtag() {
      dataLayer.push(arguments);
    }
    gtag('js', new Date());
    gtag('config', 'UA-139401597-2');
  </script>

  <script>
    // The script for the search 
    let pages = [];

    fetch('../search.json')
        .then(response => response.json())
        .then((documents) => {
            pages = documents;
            return miniSearch.addAll(pages);
    }, {});
        
    const miniSearch = new MiniSearch({
        fields: ['title', 'category'],
        storeFields: ['title', 'category', 'link']
    });
        
    const app = document.querySelector('.App');
    const search = document.querySelector('.Search');
    const searchInput = document.querySelector('.Search input');
    const clearButton = document.querySelector('.Search button.clear');
    const suggestionList = document.querySelector('.SuggestionList');
    const resultsList = document.querySelector(".ResultsList");
        
    const capitalize = (string) => string.replace(/(\b\w)/gi, (char) => char.toUpperCase());

    // Typing into search bar updates search results and suggestions
    searchInput.addEventListener('input', (event) => {
        const query = searchInput.value;

        const results = (query.length > 1) ? getSearchResults(query) : [];
        renderSearchResults(results);
  
        const suggestions = (query.length > 1) ? getSuggestions(query) : [];
        renderSuggestions(suggestions);
    });
        
    // Clicking on clear button clears search and suggestions
    clearButton.addEventListener('click', () => {
        searchInput.value = '';
        searchInput.focus();

        renderSearchResults([]);
        renderSuggestions([]);
    });

    // Clicking on a suggestion selects it
    suggestionList.addEventListener('click', (event) => {
        const suggestion = event.target;

        if (suggestion.classList.contains('Suggestion')) {
            const query = suggestion.innerText.trim();
            searchInput.value = query;
            searchInput.focus();

            const results = getSearchResults(query);
            renderSearchResults(results);
            renderSuggestions([]);
        }
    });

    // Clicking outside of search bar clears suggestions
    app.addEventListener('click', (event) => {
        renderSuggestions([]);
    });
        
    // Pressing up/down/enter key while on search bar navigates through suggestions
    search.addEventListener('keydown', (event) => {
        const key = event.key;

        if (key === 'ArrowDown') {
            selectSuggestion(+1);
        } else if (key === 'ArrowUp') {
            selectSuggestion(-1);
        } else if (key === 'Enter' || key === 'Escape') {
            searchInput.blur();
            renderSuggestions([]);
        } else {
            return;
        }
        const query = searchInput.value;
        const results = getSearchResults(query);
        renderSearchResults(results);
    });

    // Get the search results
    const getSearchResults = (query) => {
        return miniSearch.search(query).map(({ id }) => pages[id]);
    };

    // Get possible suggestions for what has been typed
    const getSuggestions = (query) => {
        return miniSearch.autoSuggest(query);
    };

    // Display the search results on the page
    const renderSearchResults = (results) => {
        resultsList.innerHTML = results.map(({title, link}) => {
            return `<li class="Result">
                <a href=\ > ${capitalize(title)}</a>
                </li>`;
            }).join('\n');

        if (results.length > 0) {
            app.classList.add('hasResults');
        } else {
            app.classList.remove('hasResults');
        }
    };

    // Display the suggestions
    const renderSuggestions = (suggestions) => {
        suggestionList.innerHTML = suggestions.map(({ suggestion }) => {
            return `<li class="Suggestion"></li>`;
        }).join('\n');

        if (suggestions.length > 0) {
            app.classList.add('hasSuggestions');
        } else {
            app.classList.remove('hasSuggestions');
        }
    };

    // Select a suggestion and set the text input text to match 
    const selectSuggestion = (direction) => {
        const suggestions = document.querySelectorAll('.Suggestion');
        const selected = document.querySelector('.Suggestion.selected');
        const index = Array.from(suggestions).indexOf(selected);

        if (index > -1) {
            suggestions[index].classList.remove('selected');
        }

        const nextIndex = Math.max(Math.min(index + direction, suggestions.length - 1), 0);
        suggestions[nextIndex].classList.add('selected');
        searchInput.value = suggestions[nextIndex].innerText;
    };     
        
    /**
     * Code for MiniSearch is based on the demo provided at:
     * https://github.com/lucaong/minisearch/blob/master/examples/plain_js
     */

  </script>
</body>